<%- include('partials/header') %>
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2>Dashboard</h2>
  <div>
    <a class="btn btn-success" href="/bugs/new">Report Bug</a>
    <% if (currentUser && currentUser.role === 'admin') { %>
      <a class="btn btn-outline-secondary" href="/admin/users">Manage Users</a>
    <% } %>
  </div>
</div>

<form class="row g-2 mb-3">
  <div class="col-md-4">
    <input class="form-control" name="q" placeholder="Search title" value="<%= filters.q || '' %>"/>
  </div>
  <div class="col-md-2">
    <select name="status" class="form-select">
      <option value="">All status</option>
      <option value="Open" <%= filters.status==='Open'?'selected':'' %>>Open</option>
      <option value="In Progress" <%= filters.status==='In Progress'?'selected':'' %>>In Progress</option>
      <option value="Closed" <%= filters.status==='Closed'?'selected':'' %>>Closed</option>
    </select>
  </div>
  <div class="col-md-2">
    <select name="severity" class="form-select">
      <option value="">All severity</option>
      <option value="Low" <%= filters.severity==='Low'?'selected':'' %>>Low</option>
      <option value="Medium" <%= filters.severity==='Medium'?'selected':'' %>>Medium</option>
      <option value="High" <%= filters.severity==='High'?'selected':'' %>>High</option>
    </select>
  </div>
  <div class="col-md-2">
    <button class="btn btn-primary">Filter</button>
  </div>
</form>

<p>Total issues: <%= total %></p>

<table class="table table-hover">
  <thead>
    <tr>
      <th>Title</th>
      <th>Severity</th>
      <th>Status</th>
      <th>Reporter</th>
      <th>Created</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% bugs.forEach(bug => { %>
      <tr>
        <td><a href="/bugs/<%= bug._id %>"><%= bug.title %></a></td>
        <td><%= bug.severity %></td>
        <td><%= bug.status %></td>
        <td><%= bug.reporter ? bug.reporter.name : 'N/A' %></td>
        <td><%= bug.createdAt.toLocaleString() %></td>
        <td>
          <a class="btn btn-sm btn-outline-primary" href="/bugs/<%= bug._id %>/edit">Edit</a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

<nav>
  <ul class="pagination">
    <% for(let i=1;i<=pages;i++){ %>
      <li class="page-item <%= i===page ? 'active' : '' %>">
        <a class="page-link" href="?page=<%= i %>&q=<%= filters.q || '' %>&status=<%= filters.status || '' %>&severity=<%= filters.severity || '' %>"><%= i %></a>
      </li>
    <% } %>
  </ul>
</nav>

<%- include('partials/footer') %>
